---
/**
 * Navbar.astro
 * ─────────────────────────────────────────────────────────────
 * Site-wide navigation for Lixan.
 *
 * Behaviour:
 *  - Transparent by default so the Hero background shows through.
 *  - Scrolled (> 40px) → .is-scrolled class adds frosted-glass blur.
 *
 * Layout  left | center | right:
 *  Logo  "Li[x]am"   |   Servicios · Casos · Proceso · Contacto   |   CTA
 *
 * Mobile: nav links collapse behind hamburger button.
 * ─────────────────────────────────────────────────────────────
 */

// Nav link definitions — easy to extend from here
const navLinks = [
  { label: 'Servicios', href: '#servicios' },
  { label: 'Proceso',   href: '#proceso'   },
  { label: 'Casos',     href: '#casos'     },
  { label: 'Contacto',  href: '#contacto'  },
];
---

<header role="banner" class="navbar" id="navbar">
  <div class="navbar-container">

    <!-- ── Brand logo ─────────────────────────────────────── -->
    <!-- Desktop: wordmark SVG  |  Mobile: isotipo (X mark) SVG -->
    <a href="/" class="navbar-logo" aria-label="Lixan — Ir al inicio">
      <!-- Full wordmark (hidden on mobile) -->
      <img
        src="/images/LixanLogo.svg"
        alt="Lixan"
        class="logo-wordmark"
        width="110"
        height="32"
        loading="eager"
      />
      <!-- Isotipo / X mark (visible only on mobile) -->
      <img
        src="/images/LixanIsotipo.svg"
        alt="Lixan"
        class="logo-isotipo"
        width="28"
        height="32"
        loading="eager"
      />
    </a>

    <!-- ── Desktop navigation (hidden on mobile) ─────────── -->
    <nav class="navbar-nav" aria-label="Navegación principal">
      <ul class="navbar-links" role="list">
        {navLinks.map((link) => (
          <li>
            <a href={link.href} class="nav-link">{link.label}</a>
          </li>
        ))}
      </ul>
    </nav>

    <!-- ── CTA + Hamburger wrapper ────────────────────────── -->
    <div class="navbar-end">

      <!-- Outline-purple CTA (always visible) -->
      <a
        href="#contacto"
        class="navbar-cta"
        aria-label="Agendar llamada de descubrimiento gratuita"
      >
        Agendar llamada →
      </a>

      <!-- Hamburger toggle (mobile only) -->
      <button
        id="menu-toggle"
        class="hamburger"
        aria-label="Abrir menú de navegación"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <!-- Three bars animate into × when open -->
        <span class="bar" id="bar1"></span>
        <span class="bar" id="bar2"></span>
        <span class="bar" id="bar3"></span>
      </button>

    </div>
  </div>

  <!-- ── Mobile menu drawer ─────────────────────────────────── -->
  <div
    id="mobile-menu"
    class="mobile-menu"
    aria-hidden="true"
  >
    <nav class="mobile-nav" aria-label="Navegación móvil">
      {navLinks.map((link) => (
        <a href={link.href} class="mobile-link">{link.label}</a>
      ))}
      <a href="#contacto" class="mobile-cta">Agendar llamada →</a>
    </nav>
  </div>
</header>

<style>
  /* ── Navbar shell ─────────────────────────────────────────── */
  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    transition:
      background-color     300ms ease,
      backdrop-filter      300ms ease,
      -webkit-backdrop-filter 300ms ease,
      border-color         300ms ease;
    border-bottom: 1px solid transparent;
  }

  /* Scroll state — toggled by JS */
  .navbar.is-scrolled {
    background-color: rgba(12, 12, 12, 0.85);
    backdrop-filter: blur(20px) saturate(160%);
    -webkit-backdrop-filter: blur(20px) saturate(160%);
    border-bottom-color: #2E2E2E; /* --color-border */
  }

  /* ── Container ───────────────────────────────────────────── */
  .navbar-container {
    max-width: 1200px;
    margin-inline: auto;
    padding-inline: 1.5rem;
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  @media (min-width: 768px) {
    .navbar-container { padding-inline: 2.5rem; }
  }

  /* ── Logo ────────────────────────────────────────────────── */
  .navbar-logo {
    display: flex;
    align-items: center;
    flex-shrink: 0;
    transition: opacity 200ms ease;
  }

  .navbar-logo:hover { opacity: 0.80; }

  /* Full wordmark — visible on desktop, hidden on mobile */
  .logo-wordmark {
    height: 30px;
    width: auto;
    display: block;
  }

  /* Isotipo (X mark) — visible on mobile, hidden on desktop */
  .logo-isotipo {
    height: 28px;
    width: auto;
    display: none;
  }

  @media (max-width: 767px) {
    .logo-wordmark { display: none; }
    .logo-isotipo  { display: block; }
  }

  /* ── Desktop nav ─────────────────────────────────────────── */
  .navbar-nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  @media (max-width: 767px) { .navbar-nav { display: none; } }

  .navbar-links {
    display: flex;
    align-items: center;
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-link {
    position: relative;
    font-size: 0.9375rem; /* 15px */
    font-weight: 500;
    color: #9E9E9E; /* --color-lixan-gray-400 */
    transition: color 220ms ease;
  }

  /* Animated underline on hover */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 1px;
    background: #A87DD1; /* --color-lixan-purple-light */
    transition: width 260ms ease;
  }

  .nav-link:hover           { color: #f0eeff; }
  .nav-link:hover::after    { width: 100%; }

  /* ── Right side (CTA + hamburger) ───────────────────────── */
  .navbar-end {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
  }

  /* ── CTA outline button ──────────────────────────────────── */
  .navbar-cta {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1.25rem;
    border: 1px solid #7B4CB3; /* --color-lixan-purple */
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    color: #f0eeff;
    white-space: nowrap;
    transition:
      background-color 240ms ease,
      box-shadow       240ms ease,
      border-color     240ms ease;
  }

  .navbar-cta:hover {
    background-color: rgba(123, 76, 179, 0.15);
    box-shadow: 0 0 20px rgba(123, 76, 179, 0.3);
    border-color: #A87DD1;
  }

  /* ── Hamburger button (mobile only) ─────────────────────── */
  .hamburger {
    display: none; /* shown via media query below */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 5px;
    width: 2rem;
    height: 2rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  @media (max-width: 767px) { .hamburger { display: flex; } }

  .bar {
    display: block;
    width: 22px;
    height: 2px;
    background: #f0eeff;
    border-radius: 2px;
    transform-origin: center;
    transition:
      transform 300ms ease,
      opacity   300ms ease;
  }

  /* Open state classes applied by JS */
  .hamburger.is-open #bar1 { transform: translateY(7px) rotate(45deg); }
  .hamburger.is-open #bar2 { opacity: 0; }
  .hamburger.is-open #bar3 { transform: translateY(-7px) rotate(-45deg); }

  /* ── Mobile menu drawer ──────────────────────────────────── */
  .mobile-menu {
    display: none; /* show via JS max-height trick */
    overflow: hidden;
    max-height: 0;
    transition: max-height 320ms ease;
    background: rgba(12, 12, 12, 0.96);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid #2E2E2E;
  }

  @media (max-width: 767px) { .mobile-menu { display: block; } }

  .mobile-nav {
    max-width: 1200px;
    margin-inline: auto;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .mobile-link {
    font-size: 1.0625rem;
    font-weight: 500;
    color: #9E9E9E;
    padding: 0.5rem 0;
    border-bottom: 1px solid #2A2A2A;
    transition: color 200ms ease;
  }

  .mobile-link:hover { color: #f0eeff; }

  .mobile-cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-top: 0.5rem;
    padding: 0.875rem 1.5rem;
    background: linear-gradient(135deg, #7B4CB3 0%, #5A3285 100%);
    border-radius: 9999px;
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    text-align: center;
    box-shadow: 0 8px 32px rgba(123, 76, 179, 0.35);
    transition: transform 200ms ease, box-shadow 200ms ease;
  }

  .mobile-cta:hover {
    transform: translateY(-1px);
    box-shadow: 0 12px 40px rgba(123, 76, 179, 0.5);
  }
</style>

<script>
  /**
   * Scroll listener
   * Adds `.is-scrolled` to #navbar when page scrollY > 40px.
   */
  const navbar  = document.getElementById('navbar');
  const toggle  = document.getElementById('menu-toggle');
  const menu    = document.getElementById('mobile-menu');
  // ── Scroll blur ──────────────────────────────────────────
  function syncScrollState(): void {
    navbar?.classList.toggle('is-scrolled', window.scrollY > 40);
  }
  syncScrollState();
  window.addEventListener('scroll', syncScrollState, { passive: true });

  // ── Hamburger toggle ─────────────────────────────────────
  let menuOpen = false;

  toggle?.addEventListener('click', () => {
    menuOpen = !menuOpen;
    toggle.setAttribute('aria-expanded', String(menuOpen));
    menu?.setAttribute('aria-hidden', String(!menuOpen));
    toggle.classList.toggle('is-open', menuOpen);
    if (menu) {
      menu.style.maxHeight = menuOpen ? `${menu.scrollHeight}px` : '0px';
    }
  });

  // Close mobile menu when any link inside is clicked
  menu?.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', () => {
      menuOpen = false;
      toggle?.setAttribute('aria-expanded', 'false');
      menu.setAttribute('aria-hidden', 'true');
      toggle?.classList.remove('is-open');
      menu.style.maxHeight = '0px';
    });
  });
</script>
